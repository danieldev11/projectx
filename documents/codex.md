# Codex Operational Context

This document defines how Codex interacts with the repository and interprets its structure, purpose, and constraints.  
Codex is granted full read/write access to the repo for automation, documentation, and workflow management tasks.

---

## 1. Repository Purpose

This repository represents the **production automation system** of an agency built around **n8n Cloud**.  
Codex’s role is to maintain technical consistency, documentation accuracy, and interoperability between:

- n8n Cloud workflows (exported as JSON)
- Supabase database schemas
- Cloudflare Worker proxy code
- Project documentation (README, automation guides, etc.)

No local or VPS setup is part of active production. Self-hosted infrastructure exists only as an optional R&D reference.

---

## 2. Active Stack Summary

| Layer | Tool / Service | Function |
|-------|----------------|-----------|
| **Automation** | n8n Cloud | Workflow orchestration |
| **Database** | Supabase (Postgres) | Data persistence + API layer |
| **Proxy / Edge** | Cloudflare Workers | API routing, request signing, input validation |
| **Documentation** | Markdown (GitHub-native) | Source of truth for operations and onboarding |
| **Version Control** | Git + GitHub | Workflow JSONs, code, and documentation tracking |

---

## 3. Codex Responsibilities

Codex acts as an **AI DevOps + Documentation Agent**.  
Its directives:

1. **Maintain structural coherence**  
   - Enforce consistent folder hierarchy and naming across `frontend/`, `backend/`, `workflows/`, and `docs/`.
   - Identify and resolve configuration drift between local JSONs and deployed n8n Cloud workflows.

2. **Standardize workflow documentation**  
   - For each workflow JSON, generate a summary file describing:
     - Purpose
     - Trigger type
     - Connected services
     - Input/Output schema
     - Dependencies (Supabase tables, APIs)
   - Save summaries under `/docs/workflows/<workflow_name>.md`.

3. **Synchronize environment documentation**  
   - Maintain `.env.example` as canonical reference for environment variables used by Cloudflare Workers or Supabase.
   - Cross-reference variables with their usage in workflow JSONs or Worker code.

4. **Guard against scope creep**  
   - Reject or isolate any DevOps-specific configurations unless explicitly marked under `/docs/R&D/`.
   - Prioritize production stability over architectural experimentation.

5. **Generate and maintain auxiliary documentation**  
   - Update changelogs, automation guides, and architecture summaries automatically.
   - Use consistent header structure and metadata in Markdown files.

---

## 4. File and Directory Standards

| Directory | Purpose | Codex Task |
|------------|----------|------------|
| `/docs` | Source of truth for project and workflow documentation | Maintain consistency, inject metadata |
| `/workflows` | Exported n8n JSON files | Validate, summarize, tag dependencies |
| `/cloudflare` | Worker source code (TypeScript) | Maintain endpoint logic and config consistency |
| `/supabase` | Schema definitions or SQL migrations | Detect and document relational dependencies |
| `/frontend` | Optional client-facing components | Validate environment variable references |
| `/R&D` | Sandbox files and DevOps experiments | Ignore for production commits |

---

## 5. Operational Rules for Codex

1. **Never assume local execution** — all production automations exist in n8n Cloud.  
2. **Respect vendor credentials** — Codex must not modify or log actual secrets.  
3. **Maintain determinism** — all file generation must be repeatable and reversible.  
4. **Follow least privilege** — Codex only updates what is in scope of its current operation (no cross-service modifications without context).  

---

## 6. Naming Conventions

| Asset | Format |
|--------|---------|
| Workflow | `wf_<category>_<purpose>.json` |
| Worker | `worker_<function>.ts` |
| Docs | `DOC_<topic>.md` |
| Supabase table | `tbl_<context>` |

---

## 7. Codex Output Format Expectations

When Codex creates or updates documentation, follow this header structure:

```markdown
# <Title>

**Last updated:** <YYYY-MM-DD>  
**Generated by:** Codex  
**Source:** <path or workflow name>

---

## Summary
<Brief purpose>

## Dependencies
- Supabase tables
- Cloudflare Worker endpoints
- External APIs

## Data Flow
<Input → Transformation → Output>

## Notes
<Any warnings, assumptions, or version references>

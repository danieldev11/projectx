# Coding Guidelines

This document defines the technical and stylistic rules AI-assisted contributions must follow when generating or editing code in this repository. The goal is clarity, consistency, security, and maintainability.

---

## Table of Contents

1. Core Principles
2. Language & Formatting Standards
3. Required File Header
4. Naming Conventions
5. Commenting Rules
6. Commit Message Format
7. Error & Exception Handling
8. Repository & Directory Structure
9. Change Management
10. Quality Assurance
11. Security Directives
12. Collaboration Etiquette

---

## 1. Core Principles

1. **Consistency > Novelty**: Reuse existing patterns, architecture, and naming. Don’t introduce new top-level directories or paradigms unless justified and documented.
2. **Minimalism**: Prefer the simplest implementation that solves the problem clearly. Avoid premature abstraction and speculative extensibility.
3. **Determinism**: Generated output must be reproducible. Avoid timestamps, random UUIDs, or environment-dependent logic unless explicitly required.
4. **Transparency**: Significant AI-generated or modified files must start with the header template (see Section 3).

---

## 2. Language & Formatting Standards

| Language | Standard | Style Notes |
|----------|----------|-------------|
| TypeScript / JavaScript | ES2020+ | 2-space indent; prefer `const`; arrow functions for callbacks; explicit return types on exported functions |
| Python | PEP 8 | 4-space indent; `snake_case` for functions & variables; docstrings for modules & complex functions |
| Markdown | GitHub-Flavored | Incremental heading order; avoid trailing spaces; wrap lines < 100 chars when editing prose |
| JSON | RFC 8259 | 2-space indent; no comments; no trailing commas |
| YAML | v1.2 | 2-space indent; avoid tabs; quote only when needed |

All code must pass existing linters/formatters. If unsure, prefer deterministic formatting (e.g. Prettier, Black) consistent with project tooling.

---

## 3. Required File Header

Add only when the file is newly created or substantially reworked by AI assistance.

For languages using `//` comments (TypeScript, JavaScript) substitute the marker; otherwise use `#`.

```text
# =========================================================
#  Generated by: AI Assistant
#  Purpose: <Short description>
#  Date: <YYYY-MM-DD>
#  Scope: <Production | R&D>
# =========================================================
```

Do NOT duplicate headers on trivial edits.

---

## 4. Naming Conventions

| Asset Type | Pattern | Examples |
|------------|---------|----------|
| Variables (TS/JS) | `camelCase` | `leadSource`, `apiClient` |
| Variables (Python) | `snake_case` | `lead_source`, `api_client` |
| Functions | verb + noun | `processLeadData()`, `fetchRecords()` |
| Files | lowercase kebab (TS/JS) / snake or dash (misc) | `lead-intake.ts`, `workflow-summary.md` |
| Constants | UPPER_CASE + underscores | `MAX_RETRIES`, `CACHE_TTL_SECONDS` |
| Env Vars | UPPER_CASE + underscores | `SUPABASE_URL`, `API_SECRET` |

Avoid unclear abbreviations; allow domain-specific shorthands (e.g. `n8n`, `API`, `URL`).

---

## 5. Commenting Rules

- Each non-trivial function: a one-line summary (or docstring in Python) explaining purpose and primary side effects.
- Use inline comments for multi-step logic blocks; group them above the block.
- Don’t comment self-evident operations (`i += 1`, trivial assignments).
- Document assumptions, external services, rate limits, and required environment variables.

Example (Python):

```python
# Fetch new leads from Supabase and push to n8n Cloud
def sync_new_leads():
    ...
```

---

## 6. Commit Message Format

```text
<type>: <concise summary>

[optional body]
```

Allowed types:

- `feat` – new feature
- `fix` – bug fix
- `docs` – documentation change
- `refactor` – structural change without new features
- `config` – environment/build/workflow config
- `test` – tests added/updated

Example:

```text
feat: add Cloudflare Worker handler for lead proxy
```

Use body section for rationale on refactors or complex changes.

---

## 7. Error & Exception Handling

- Anticipate known failure modes (API errors, missing env vars, timeouts, rate limits).
- Fail loudly and clearly: return or throw errors with actionable messages (never expose secrets).
- Prefer graceful degradation when an optional dependency fails.
- Centralize error logging when feasible; sanitize outputs.

---

## 8. Repository & Directory Structure

Current key paths:

| Directory | Purpose |
|-----------|---------|
| `frontend/` | Astro + Tailwind frontend application |
| `documents/` | Project documentation (this file, readme, standards) |
| `workers/` | Serverless or background worker code (placeholder) |

Do not create new top-level directories without maintainers' approval and documentation.

---

## 9. Change Management

- Do not delete files unless explicitly instructed.
- If overwriting uncertain content, optionally create a temporary backup: `<filename>.bak` (remove before merging).
- Large structural adjustments require a `refactor:` commit type and brief rationale.

---

## 10. Quality Assurance

- Run linters/formatters before committing.
- Validate JSON/YAML syntax.
- Confirm Markdown headings render correctly and relative links resolve.
- Ensure environment variable references exist in deployment configuration.
- Cross-check IDs or endpoints referenced in code against documentation.

---

## 11. Security Directives

- Never commit credentials (API keys, tokens, secrets) or embed them in examples.
- Always consume secrets via environment variables or secret management tooling.
- Redact or omit sensitive identifiers in exported workflow JSON.
- Avoid logging full payloads containing PII; log minimal metadata.

---

## 12. Collaboration Etiquette

- Human maintainer decisions take precedence over AI suggestions.
- Surface ambiguity with comments or TODO markers rather than assuming intent.
- When overlapping edits occur, propose diffs instead of overwriting.
- Keep changes scoped; avoid bundling unrelated modifications.

---

Last updated: 2025-11-06
